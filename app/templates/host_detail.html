<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Host details - {{ host.address }}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/2.0.0/modern-normalize.min.css" />
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body data-address="{{ host.address }}" data-poll-interval="{{ settings.monitor_interval_seconds }}">
    <header class="hero hero--compact">
      <div>
        <p class="eyebrow"><a href="/">← Back to dashboard</a></p>
        <h1>Host details</h1>
        <p class="muted">Expanded metrics for {{ host.name }} ({{ host.address }}).</p>
      </div>
      <div class="cta cta--split">
        <a class="link" href="/settings">Settings</a>
        <button id="delete-host" class="ghost" data-address="{{ host.address }}">Delete host</button>
      </div>
    </header>

    <main>
      <section class="card card--detail">
        <header class="card__header">
          <div>
            <p class="eyebrow">Polling every {{ settings.monitor_interval_seconds }}s</p>
            <h2><span class="badge badge--{{ host.state }}" aria-hidden="true"></span> {{ host.address }}</h2>
          </div>
        </header>
        <div class="detail-grid" id="detail-grid">
          <div>
            <p class="muted">Latency</p>
            <p id="latency">{{ '%.1f' % host.latency_ms if host.latency_ms is not none else '—' }} ms</p>
          </div>
          <div>
            <p class="muted">Min latency</p>
            <p id="latency-min">{{ '%.1f' % host.latency_min_ms if host.latency_min_ms is not none else '—' }} ms</p>
          </div>
          <div>
            <p class="muted">Max latency</p>
            <p id="latency-max">{{ '%.1f' % host.latency_max_ms if host.latency_max_ms is not none else '—' }} ms</p>
          </div>
          <div>
            <p class="muted">Packet loss</p>
            <p id="packet-loss">{{ '%.1f' % host.packet_loss_pct if host.packet_loss_pct is not none else '—' }}%</p>
          </div>
          <div>
            <p class="muted">Success rate</p>
            <p id="success-rate">{{ '%.1f' % (100 - host.packet_loss_pct) if host.packet_loss_pct is not none else '—' }}%</p>
          </div>
          <div>
            <p class="muted">Packets (received/sent)</p>
            <p id="packets">{{ host.packets_received if host.packets_received is not none else '—' }}/{{ host.packets_sent if host.packets_sent is not none else '—' }}</p>
          </div>
          <div>
            <p class="muted">SNMP sysName</p>
            <p id="sysname">{{ host.snmp_sysname or '—' }}</p>
          </div>
          <div>
            <p class="muted">CPU usage</p>
            <p id="cpu">{{ '%.1f' % host.cpu_usage_pct if host.cpu_usage_pct is not none else '—' }}%</p>
          </div>
          <div>
            <p class="muted">Memory used</p>
            <p id="memory">{{ '%.1f' % host.memory_used_pct if host.memory_used_pct is not none else '—' }}%</p>
          </div>
          <div>
            <p class="muted">Interface temp</p>
            <p id="interface-temp">{{ '%.1f' % host.interface_temp_c if host.interface_temp_c is not none else '—' }}°C</p>
          </div>
          <div>
            <p class="muted">System temp</p>
            <p id="system-temp">{{ '%.1f' % host.system_temp_c if host.system_temp_c is not none else '—' }}°C</p>
          </div>
          <div>
            <p class="muted">PSU status</p>
            <p id="psu-status">
              {{ ', '.join(host.psu_statuses) if host.psu_statuses else host.psu_status or '—' }}
            </p>
          </div>
          <div>
            <p class="muted">Throughput (in/out)</p>
            <p id="throughput">
              {{ '%.2f' % (host.interface_in_bps / 1_000_000) if host.interface_in_bps is not none else '—' }} /
              {{ '%.2f' % (host.interface_out_bps / 1_000_000) if host.interface_out_bps is not none else '—' }} Mbps
            </p>
          </div>
          <div>
            <p class="muted">Last checked</p>
            <p id="last-checked">{{ host.last_checked.strftime('%Y-%m-%d %H:%M:%S') if host.last_checked else '—' }}</p>
          </div>
          <div>
            <p class="muted">Last alert</p>
            <p id="last-alert">{{ host.last_alert.strftime('%Y-%m-%d %H:%M:%S') if host.last_alert else '—' }}</p>
          </div>
          <div>
            <p class="muted">Notes</p>
            <p id="notes">{{ '; '.join(host.notes) if host.notes else '—' }}</p>
          </div>
          <div>
            <p class="muted">Status</p>
            <p id="state">{{ host.state }}</p>
          </div>
        </div>
      </section>

      <section class="card card--detail">
        <header class="card__header">
          <div>
            <p class="eyebrow">Health trends</p>
            <h2>Latency & packet loss over time</h2>
          </div>
        </header>
        <div class="chart-wrapper">
          <canvas id="health-chart" height="180" aria-label="Latency and packet loss chart"></canvas>
        </div>
      </section>

      <section class="card card--detail">
        <header class="card__header">
          <div>
            <p class="eyebrow">System health</p>
            <h2>CPU, memory, and interface temperature</h2>
          </div>
        </header>
        <div class="chart-wrapper">
          <canvas id="system-chart" height="180" aria-label="CPU and memory chart"></canvas>
        </div>
      </section>

      <section class="card card--detail">
        <header class="card__header">
          <div>
            <p class="eyebrow">Interface reachability</p>
            <h2>Success rate and packets</h2>
          </div>
        </header>
        <div class="chart-wrapper">
          <canvas id="interface-chart" height="180" aria-label="Packet success chart"></canvas>
        </div>
      </section>

      <section class="card card--detail">
        <header class="card__header">
          <div>
            <p class="eyebrow">Interface throughput</p>
            <h2>Ingress and egress over time</h2>
          </div>
        </header>
        <div class="chart-wrapper">
          <canvas id="throughput-chart" height="180" aria-label="Interface throughput chart"></canvas>
        </div>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/detail.js"></script>
  </body>
</html>
